<%- include('../partials/head') -%>

<%- include('../partials/nav') -%>

    <div class="main-content">

        <div class="page-content">
            <div class="container-fluid">

                <!-- start page title -->
                <div class="row">
                    <div class="col-12">
                        <div class="page-title-box d-flex align-items-center justify-content-between">
                            <h4 class="mb-0 font-size-18">Store</h4>

                            <div class="page-title-right">
                                <ol class="breadcrumb m-0">
                                    <li class="breadcrumb-item"><a href="javascript: void(0);">Store</a></li>
                                    <!-- <li class="breadcrumb-item active">Sto</li> -->
                                </ol>
                            </div>

                           

                        </div>
                    </div>
                </div>
                <!-- end page title -->
                <div class="row">
                    <div class="col-xl-12">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title">Store edit</h4>
                                <p class="card-title-desc"></p>
                                <form class="needs-validation storeRegister"  novalidate>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="validationCustom01">Store name</label>
                                                <input type="text" class="form-control" id="validationCustom01" placeholder="Store name" name="storeName" value="<%= Store_update.storeName %>"  required>
                                                <div class="valid-feedback">
                                                    Looks good!
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="validationCustom02">Store Manager name</label>
                                                <input type="text" class="form-control" id="validationCustom02" placeholder="Store Manager Name" name="storeManagerName" value="<%= Store_update.storeMname %>"  required>
                                                <div class="valid-feedback">
                                                    Looks good!
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label for="validationCustom03">Store Manager Phone</label>
                                                <input type="text" class="form-control" id="validationCustom03" placeholder="Store Manager Phone" name="storeManagerPhone" value="<%= Store_update.storeMphone %>" required>
                                                <div class="invalid-feedback">
                                                    Please provide a valid city.
                                                </div>
                                            </div>
                                        </div>
                                      <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="validationCustom04">Store Location</label>
                                                <input type="text" class="form-control" id="Place_adress" placeholder="lat" name="storeLocation1" required>
                                                <div class="invalid-feedback">
                                                    Please provide a valid state.
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="validationCustom04">Store Location</label>
                                                <input type="text" class="form-control" id="Place_adress" placeholder="long" name="storeLocation2" required>
                                                <div class="invalid-feedback">
                                                    Please provide a valid state.
                                                </div>
                                            </div>
                                        </div>

                              

                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <div class="col-sm-4 col-md-4 col-xl-3">
                                                    <div class="my-4 text-center">
                                                        
                                                        <!-- Extra Large modal -->
                                                        <button style="white-space: nowrap; margin-top: 2.7px;" type="button" class="btn btn-primary waves-effect waves-light" data-toggle="modal" data-target=".bs-example-modal-xl">Add location</button>
                                                    </div>
            
            
                                                    <!--  Modal content for the above example -->
                                                    <div class="modal fade bs-example-modal-xl" tabindex="-1" role="dialog" aria-labelledby="myExtraLargeModalLabel" aria-hidden="true">
                                                        <div class="modal-dialog modal-xl">
                                                            <div class="modal-content">
                                                                <div class="modal-header">
                                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                        <span aria-hidden="true">&times;</span>
                                                                    </button>
                                                                </div>
                                                                <div class="modal-body">
                                                                    <div id="map" style="width: 100%; height: 500px;border-radius: 5px;"
                                                                    ></div>
                                                                </div>
                                                            </div><!-- /.modal-content -->
                                                        </div><!-- /.modal-dialog -->
                                                    </div><!-- /.modal -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <label for="validationCustom05">Store Type</label>
                                            <select class="form-control select2" name="storeType" required>
                                                <option value="">plear select store type</option>
                                                <option value="Store">Store</option>
                                                <option value="Mini-Store">Mini-Store</option>
                                            </select>
                                        </div>
                                    <button  class="btn btn-primary mt-3" type="submit">Update</button>
                                </form>
                            </div>
                        </div>
                        <!-- end card -->
                    </div> <!-- end col -->

                </div>

                <!-- end row -->

                
                <!-- end row -->
            </div> <!-- container-fluid -->

        </div>
        <!-- End Page-content -->

        
        <footer class="footer">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-sm-6">
                        <script>document.write(new Date().getFullYear())</script> Â© Skote.
                    </div>
                    <div class="col-sm-6">
                        <div class="text-sm-right d-none d-sm-block">
                            Design & Develop by Themesbrand
                        </div>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <script>
        const form = document.querySelector('.storeRegister');
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const storeName = form.storeName.value;
            const storeMname = form.storeManagerName.value;
            const storeMphone = form.storeManagerPhone.value;
            const storeLocation1 = form.storeLocation1.value;
            const storeLocation2 = form.storeLocation2.value;
            const storeType = form.storeType.value;
            
            try {
                const res = await fetch('/edit/<%= Store_update._id %>', {
                    method: 'POST',
                    body: JSON.stringify({storeName, storeMname, storeMphone, storeType, storeLocation1,storeLocation2}),
                    headers: {'Content-Type': 'application/json'}
                })
                
                const data = await res.json();
                console.log
                if(data.store){
                    location.assign('/store')
                }
            } catch (err) {
                
            }
        })

        mapboxgl.accessToken = 'your mapbox_access_token';
		var map = new mapboxgl.Map({
		  container: 'map',
		  style: 'mapbox://styles/mapbox/streets-v11',
		  center: [45.3182, 2.0469],
		  zoom: 13
		});

        var coordinates = null;
		map.on('style.load', function() {

		  map.on('click', function(e) {
		    coordinates = e.lngLat;
            con(coordinates)
		    new mapboxgl.Popup()
		      .setLngLat(coordinates)
		      .setHTML('you clicked here: <br/>' + coordinates)
		      .addTo(map);
		  });
        });
        const con = (data) => {
            form.storeLocation1.value = data.lng
            form.storeLocation2.value = data.lat
        }
    </script>
    
    <%- include('../partials/footer') -%>
